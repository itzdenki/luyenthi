{% extends "base.html" %}
{% block title %}Kết quả bài thi{% endblock %}
{% block content %}
<style>
    .result-wrapper {
        background-color: var(--bg-surface);
        padding: 2rem;
        border-radius: 0.75rem;
        text-align: center;
        border: 1px solid var(--border);
    }
    .answer-review-container {
        margin-top: 2rem;
        text-align: left;
        display: none; /* Ẩn mặc định */
    }
    .review-question-box {
        background-color: var(--bg-primary);
        padding: 1.5rem;
        border-radius: 0.5rem;
        margin-bottom: 1.5rem;
        border: 1px solid var(--border);
    }
    .review-choice-item {
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        border-radius: 0.25rem;
        border-left: 4px solid transparent;
    }
    .correct-answer {
        border-left-color: var(--success);
        background-color: rgba(16, 185, 129, 0.1);
    }
    .user-incorrect {
        border-left-color: var(--error);
        background-color: rgba(220, 38, 38, 0.1);
    }
</style>

<div class="result-wrapper">
    <h2>Kết quả bài thi: {{ result.exam.title }}</h2>
    <p class="details">Bạn đã hoàn thành bài thi vào lúc {{ result.submitted_at|date:"H:i, d/m/Y" }}</p>
    <p>Điểm số của bạn là:</p>
    <p class="score-display">{{ result.score|floatformat:2 }}</p>
    
    <div style="display: flex; justify-content: center; gap: 1rem; margin-top: 2rem;">
        <a href="{% url 'student_exam_list' %}" class="btn" style="background-color: var(--text-secondary); color: var(--bg-primary);">Làm bài khác</a>
        <button id="toggle-answers-btn" class="btn btn-primary">Xem đáp án</button>
    </div>
</div>

<!-- KHU VỰC XEM LẠI ĐÁP ÁN -->
<div class="answer-review-container" id="answer-review-container">
    <h2 style="margin-bottom: 2rem; text-align: center;">Đáp án chi tiết</h2>
    {% for question in questions %}
        <div class="review-question-box">
            <h4>Câu {{ forloop.counter }}: {{ question.text|safe }}</h4>
            <div style="margin-top: 1rem;">
                {% for choice in question.choices.all %}
                    {% with choice_id_str=choice.id|stringformat:"s" %}
                        <div class="review-choice-item 
                            {% if choice.is_correct %}correct-answer{% endif %}
                            {% if choice_id_str == question.student_answer and not choice.is_correct %}user-incorrect{% endif %}
                        ">
                            <input type="radio" disabled {% if choice_id_str == question.student_answer %}checked{% endif %}>
                            <label>{{ choice.text|safe }}</label>
                        </div>
                    {% endwith %}
                {% endfor %}
            </div>
        </div>
    {% endfor %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const toggleBtn = document.getElementById('toggle-answers-btn');
    const reviewContainer = document.getElementById('answer-review-container');

    toggleBtn.addEventListener('click', function() {
        if (reviewContainer.style.display === 'none' || reviewContainer.style.display === '') {
            reviewContainer.style.display = 'block';
            toggleBtn.textContent = 'Ẩn đáp án';
        } else {
            reviewContainer.style.display = 'none';
            toggleBtn.textContent = 'Xem đáp án';
        }
    });
});
</script>
{% endblock %}